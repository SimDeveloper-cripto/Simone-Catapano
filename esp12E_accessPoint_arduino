#include <ESP8266WiFi.h>
#include <WiFiClient.h>
#include <ESP8266WebServer.h>

#ifndef APSSID
#define APSSID "CasaDomotica"
#define APPSK  "casadomo123"
#endif

const char *ssid = APSSID;
const char *password = APPSK;
String webPage;

ESP8266WebServer server(80); // 192.168.4.1

void setup() {
  pinMode(2,OUTPUT);
  pinMode(3,OUTPUT);
  pinMode(4,OUTPUT);
  
  webPage += "<h1> <center> BENVENUTO NEL WEB SERVER CASA DOMOTICA </center> </h1>"; 
  webPage += "<p> Luce del bagno: ";
  webPage += "<a href=\"LuceBagnoOn\"> <button>ON</button></a>&nbsp;";
  webPage += "<a href=\"LuceBagnoOff\"> <button>OFF</button></a>&nbsp;";

  delay(1000);
  Serial.begin(9600);
  Serial.println();
  Serial.print("Configuring access point..."); Serial.println();
  
  WiFi.softAP(ssid, password);

  IPAddress myIP = WiFi.softAPIP();
  Serial.print("Indirizzo IP dell'AccessPoint: ");
  Serial.println(myIP);
 
  server.on("/", [](){
    server.send(200, "text/html", webPage);
  });
  server.on("/LuceBagnoOn", [](){
    server.send(200, "text/html", webPage);
    digitalWrite(2, HIGH);
    delay(1000);
  });
  server.on("/LuceBagnoOff", [](){
    server.send(200, "text/html", webPage);
    digitalWrite(2, LOW);
    delay(1000); 
  });

  server.begin();
  Serial.println("HTTP server started");
}

void loop() {
  server.handleClient();
}
