#include <ESP8266WiFi.h>
#include <PubSubClient.h>
 
const char * ssid = "WiFi Name"; // Inserisci il tuo nome WiFi
const char * password = "WiFi Password"; // Immettere la password WiFi
const char * mqttServer = "m16.cloudmqtt.com";
const int mqttPort = 37181;
const char * mqttUser = "otfxknod";
const char * mqttPassword = "nSuUc1dDLygF";
 
WiFiClient espClient;
Client PubSubClient (espClient);
 
void setup () {
 
  Serial.begin (115200);
 
  WiFi.begin (ssid, password);
 
  while (WiFi.status ()! = WL_CONNECTED) {
    delay (500);
    Serial.println ("Connessione al WiFi ..");
  }
  Serial.println ("
 
  client.setServer (mqttServer, mqttPort);
  client.setCallback (callback);
 
  while (! client.connected ()) {
    Serial.println ("Connessione a MQTT ...");
 
    if (client.connect ("ESP8266Client", mqttUser, mqttPassword)) {
 
      Serial.println ("connesso");  
 
    } else {
 
      Serial.print ("errore con stato");
      Serial.print (client.state ());
      ritardo (2000);
 
    }
  }
 
  client.publish ("esp / test", "hello"); // Nome argomento
  client.subscribe ("esp / test");
 
}
 
void callback (char * topic, byte * payload, unsigned int length) {
 
  Serial.print ("Messaggio arrivato nell'argomento:");

 
  Serial.print ( "Messaggio:");
  per (int i = 0; i <lunghezza; i ++) {
    Serial.print ((char) payload [i]);
  }
 
  Serial.println ();
  Serial.println ( "-----------------------");
 
}
 
void loop () {
  client.loop ();
}
